import"./esm-shims-CaZMYoY8.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import{t as e}from"./ofetch-VsB2Peor.js";import{load as t}from"cheerio";const n={path:`/iap/:country/:id`,categories:[`program-update`],example:`/appstore/iap/us/id953286746`,parameters:{country:"App Store Country, obtain from the app URL https://apps.apple.com/us/app/id953286746, in this case, `us`",id:"App Store app id, obtain from the app URL https://apps.apple.com/us/app/id953286746, in this case, `id953286746`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`In-App-Purchase Price Drop Alert`,maintainers:[`HenryQW`],handler:i},r=e=>{if(!e)throw Error(`Empty web experience config meta content`);return JSON.parse(decodeURIComponent(e)).MEDIA_API.token};async function i(n){let i=n.req.param(`country`),a=n.req.param(`id`),o=`https://apps.apple.com/${i}/app/${a}`,s=t(await e(o)),c=s(`html`).attr(`lang`),l=r(s(`meta[name="web-experience-app/config/environment"]`).attr(`content`)),u=(await e(`https://amp-api-edge.apps.apple.com/v1/catalog/${i}/apps/${a.replace(`id`,``)}`,{query:{platform:`web`,include:`merchandised-in-apps,top-in-apps,eula`,l:c},headers:{authorization:`Bearer ${l}`,origin:`https://apps.apple.com`}})).data[0],d=u.attributes,f=d.deviceFamilies.includes(`mac`)?`macOS`:`iOS`,p=[],m=u.relationships[`top-in-apps`].data;return m&&(p=m.map(({attributes:e})=>({title:`${e.name} is now ${e.offers[0].priceFormatted}`,link:e.url,guid:`${e.url}:${e.offerName}:${e.offers[0].priceString}`,description:e.artwork?e.description.standard+`<br><img src=${e.artwork.url.replace(`{w}x{h}{c}.{f}`,`3000x3000bb.webp`)}>`:e.description.standard}))),{title:`${i.toLowerCase()===`cn`?`内购限免提醒`:`IAP price watcher`}: ${d.name} for ${f}`,link:o,item:p}}export{n as route};